<div class="container">
  <h1>受注情報編集</h1>

  <div class="row mb-3 align-items-center">
    <div class="col-md-12">
      <strong>受注番号：</strong><%= @order.order_number %>
      <% if @order.invoiced? %>
        <span style="display: inline-block; margin-left: 1rem;">
          <strong>請求書番号：</strong>
          <% @order.invoices.each_with_index do |invoice, index| %>
            <%= link_to invoice.invoice_number, invoice_path(invoice), class: 'text-decoration-none' %><%= ', ' unless index == @order.invoices.size - 1 %>
          <% end %>
        </span>
      <% end %>
    </div>
  </div>

  <%= render 'form', order: @order %>

  <div class="mt-3">
    <%= link_to '詳細', @order, class: 'btn btn-sm btn-info' %>
    <%= link_to '戻る', orders_path, class: 'btn btn-sm btn-secondary' %>
  </div>
</div>

<% if @order.invoiced? %>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // フォームを取得
    const orderForm = document.querySelector('form');
    
    // フォーム送信前の処理を追加
    orderForm.addEventListener('submit', function(event) {
      // デフォルトの送信動作を一時停止
      event.preventDefault();
      
      // 確認ダイアログを表示
      if (confirm('請求済みの受注情報です。本当に編集しますか？')) {
        // OKがクリックされた場合はフォームを送信
        this.submit();
      }
      // キャンセルの場合は何もしない（送信は中止される）
    });
  });
</script>
<% end %> 