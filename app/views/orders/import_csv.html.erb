<div class="container">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">CSVファイルからの一括受注登録</h3>
        </div>

        <div class="card-body">
          <form action="<%= process_csv_orders_path %>" method="post" enctype="multipart/form-data" class="mb-4" data-controller="orders--import-csv">
            <%= hidden_field_tag :authenticity_token, form_authenticity_token %>

            <div class="row">
              <div class="col-12 mb-3">
                <div class="form-group">
                  <label for="file" class="form-label">CSVファイル<span class="text-danger">*</span></label>
                  <input type="file" name="file" id="file" class="form-control" required accept=".csv">
                  <small class="text-muted">※CSVファイルはUTF-8（BOM付き）エンコーディングで保存されたものをご使用ください</small>
                  <small class="d-block text-muted">※Excelで保存する場合：「ファイル」→「名前を付けて保存」→「CSV UTF-8（コンマ区切り）（*.csv）」を選択してください</small>
                  <small class="d-block text-muted">※取引先コード/取引先名、受注日などの列がCSVに必要です</small>
                  <small class="d-block text-warning">※1受注あたり2明細まで登録できます。3つ目以降は登録後に手動で追加してください</small>
                  <small class="d-block text-info">※1受注に複数商品を登録する場合：同じ取引先・受注日・支払方法の商品を複数行で記載してください（2行形式）</small>
                </div>
              </div>
            </div>

            <div class="d-flex justify-content-between mt-3">
              <div>
                <a href="<%= orders_path %>" class="btn btn-secondary">戻る</a>
              </div>
              <div>
                <button type="submit" class="btn btn-primary">CSVファイルをアップロードして一括登録</button>
              </div>
            </div>
          </form>

          <div class="card mt-4">
            <div class="card-header">
              <h4 class="card-title">CSVファイルのフォーマット</h4>
            </div>
            <div class="card-body">
              <p>CSVファイルは以下のヘッダーを持つことができます：</p>
              <div class="table-responsive">
                <table class="table table-bordered">
                  <thead>
                    <tr>
                      <th>列名</th>
                      <th>説明</th>
                      <th>必須</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>取引先コード</td>
                      <td>取引先コード（取引先マスタに登録されているもの）</td>
                      <td>CSVから基本情報を入力する場合、取引先コードまたは取引先名のいずれか必須</td>
                    </tr>
                    <tr>
                      <td>取引先名</td>
                      <td>取引先名（取引先マスタに登録されているもの）</td>
                      <td>CSVから基本情報を入力する場合、取引先コードまたは取引先名のいずれか必須</td>
                    </tr>
                    <tr>
                      <td>支払方法</td>
                      <td>支払方法名（支払方法マスタに登録されているもの）</td>
                      <td>必須</td>
                    </tr>
                    <tr>
                      <td>受注日</td>
                      <td>受注日（yyyy-mm-dd形式）</td>
                      <td>CSVから基本情報を入力する場合、必須</td>
                    </tr>
                    <tr>
                      <td>予定納品日</td>
                      <td>予定納品日（yyyy-mm-dd形式）</td>
                      <td>任意</td>
                    </tr>
                    <tr>
                      <td>確定納品日</td>
                      <td>確定納品日（yyyy-mm-dd形式）</td>
                      <td>任意</td>
                    </tr>
                    <tr>
                      <td>商品コード</td>
                      <td>商品コード（商品マスタに登録されているもの）</td>
                      <td>商品コードまたは商品名のいずれか必須</td>
                    </tr>
                    <tr>
                      <td>商品名</td>
                      <td>商品名（商品マスタに登録されているもの）</td>
                      <td>商品コードまたは商品名のいずれか必須</td>
                    </tr>
                    <tr>
                      <td>数量</td>
                      <td>商品の数量（1以上の整数）</td>
                      <td>必須</td>
                    </tr>
                    <tr>
                      <td>単価</td>
                      <td>商品の単価（指定しない場合は商品マスタの単価が使用されます）</td>
                      <td>任意</td>
                    </tr>
                    <tr>
                      <td>税率</td>
                      <td>適用税率（指定しない場合は商品マスタの税率が使用されます）</td>
                      <td>任意</td>
                    </tr>
                    <tr>
                      <td>単位</td>
                      <td>単位名（単位マスタに登録されているもの）</td>
                      <td>任意</td>
                    </tr>
                    <tr>
                      <td>備考</td>
                      <td>各商品に関する備考</td>
                      <td>任意</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="alert alert-info mt-3">
                <strong>重要：</strong>1受注あたり2明細まで登録できます。3つ目以降の明細は登録後に手動で編集して追加してください。
              </div>

              <div class="alert alert-warning mt-3">
                <strong>CSVフォーマットについて：</strong><br>
                1受注に複数商品を登録する場合は、<strong>2行形式（複数行）</strong>で記載してください。<br>
                同じ取引先コード・受注日・支払方法の商品は同じ受注として自動的にグループ化されます。<br>
                <strong>例：</strong>1受注に商品Aと商品Bを登録する場合、2行で記載します（1行目：商品A、2行目：商品B）
              </div>

              <div class="mt-3">
                <h5>サンプルCSV（2行形式の例）：</h5>
                <p class="text-muted">以下の例では、1行目と2行目が同じ受注（取引先コードC001、受注日2023-05-01）としてグループ化され、商品Aと商品Bの2明細が登録されます。</p>
                <pre class="bg-light p-3">取引先コード,取引先名,支払方法,受注日,予定納品日,確定納品日,商品コード,商品名,数量,単価,税率,単位,備考
C001,株式会社A,銀行振込,2023-05-01,2023-05-10,,P001,商品A,2,1000,10,個,サンプル備考1
C001,株式会社A,銀行振込,2023-05-01,2023-05-10,,P002,商品B,3,2000,8,箱,サンプル備考2
C002,株式会社B,代金引換,2023-05-02,2023-05-15,,P003,商品C,1,3000,10,セット,サンプル備考3</pre>
              </div>

              <div class="mt-3">
                <%= link_to download_sample_csv_orders_path, class: "btn btn-outline-primary" do %>
                  <i class="fas fa-download"></i> サンプルCSVファイル（UTF-8）
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>