<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1>請求書詳細</h1>
    <div>
      <%= link_to '編集', edit_invoice_path(@invoice), class: 'btn btn-primary' %>
      <%= link_to '一覧に戻る', invoices_path, class: 'btn btn-secondary' %>
    </div>
  </div>

  <% if notice %>
    <div class="alert alert-success"><%= notice %></div>
  <% end %>

  <div class="card mb-4">
    <div class="card-header">
      <h2 class="card-title"><%= @invoice.invoice_number %></h2>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-4">
          <h5>取引先:</h5>
          <p><%= @invoice.customer.company_name %></p>
        </div>
        <div class="col-md-4">
          <h5>請求日:</h5>
          <p><%= l @invoice.invoice_date %></p>
        </div>
        <div class="col-md-4">
          <h5>支払期限:</h5>
          <p><%= l @invoice.due_date if @invoice.due_date %></p>
        </div>
      </div>

      <% if @invoice.notes.present? %>
        <div class="row mt-3">
          <div class="col-12">
            <h5>備考:</h5>
            <p><%= simple_format @invoice.notes %></p>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <h3>対象受注</h3>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>受注番号</th>
        <th>受注日</th>
        <th>確定納品日</th>
        <th>合計金額（税抜）</th>
        <th>合計金額（税込）</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody>
      <% @invoice.orders.each do |order| %>
        <tr>
          <td><%= order.order_number %></td>
          <td><%= l order.order_date %></td>
          <td><%= l order.actual_delivery_date if order.actual_delivery_date %></td>
          <td><%= number_to_currency(order.order_items.sum { |item| item.subtotal_without_tax }) %></td>
          <td><%= number_to_currency(order.order_items.sum { |item| item.subtotal }) %></td>
          <td>
            <%= link_to '詳細', order_path(order), class: 'btn btn-sm btn-info' %>
          </td>
        </tr>
      <% end %>
      <tr class="table-info">
        <td colspan="3"><strong>合計</strong></td>
        <td><strong><%= number_to_currency(@invoice.total_amount_without_tax) %></strong></td>
        <td><strong><%= number_to_currency(@invoice.total_amount) %></strong></td>
        <td></td>
      </tr>
    </tbody>
  </table>

  <div class="text-center mt-4">
    <button class="btn btn-success" onclick="window.print();">印刷する</button>
  </div>
</div> 